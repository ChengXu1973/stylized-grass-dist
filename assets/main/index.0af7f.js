System.register("chunks:///_virtual/grass-animation-module.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,n,r,o,a,u,l,c,s;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){n=e.cclegacy,r=e._decorator,o=e.CCFloat,a=e.Vec2,u=e.Texture2D,l=e.Vec3,c=e.v2,s=e.v3}],execute:function(){var p,d,b,f,m,g,h,y,w,v,z;n._RF.push({},"8aedc0uUxtGzamVpUJBMUgi","grass-animation-module",void 0);var D=r.ccclass,F=r.property;e("GrassAnimationModule",(p=D("GrassAnimationModule"),d=F({type:o,min:0}),b=F(a),f=F(u),m=F(l),p((y=i((h=function(){function e(){t(this,"windStrength",y,this),t(this,"windDirection",w,this),t(this,"windField",v,this),t(this,"bend",z,this)}return e.prototype.update=function(e){},e}()).prototype,"windStrength",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),w=i(h.prototype,"windDirection",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c()}}),v=i(h.prototype,"windField",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=i(h.prototype,"bend",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s()}}),g=h))||g));n._RF.pop()}}}));

System.register("chunks:///_virtual/grass-animation.ts",["cc"],(function(){var t;return{setters:[function(a){t=a.cclegacy}],execute:function(){t._RF.push({},"aba06mK05NNe5JrORhmaZIN","grass-animation",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/grass-base.ts",["./rollupPluginModLoBabelHelpers.js","cc","./grass-model-instancing.ts","./grass-model-normal.ts"],(function(e){var t,s,n,o,i,a,r;return{setters:[function(e){t=e.inheritsLoose},function(e){s=e.cclegacy,n=e.gfx,o=e.director,i=e.ModelRenderer},function(e){a=e.GrassModelInstancing},function(e){r=e.GrassModelNormal}],execute:function(){s._RF.push({},"fdd4cvcL0lF148bEg7CWF9V","grass-base",void 0);e("GrassBase",function(e){function s(){return e.apply(this,arguments)||this}t(s,e);var i=s.prototype;return i.onLoad=function(){var e;e=n.deviceManager.gfxDevice.hasFeature(n.Feature.INSTANCED_ARRAYS)?o.root.createModel(a):o.root.createModel(r),0===this._models.length?this._models.push(e):this._models[0]=e,e.receiveShadow=!0,e.node=e.transform=this.node,e.init(this.material,this.spawner.spawn())},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._models.length>0&&this._models[0]&&this._detachFromScene()},i.update=function(){this.animation.update(this.material)},i.grow=function(){var e=this.sampler.sample();this._models[0].updateGrass(e)},i._attachToScene=function(){if(e.prototype._attachToScene.call(this),this._models.length>0&&this._models[0]&&this.node&&this.node.scene){var t=this._models[0];t.scene&&this._detachFromScene(),this._getRenderScene().addModel(t)}},i._detachFromScene=function(){if(this._models.length>0&&this._models[0]){var e=this._models[0];e.scene&&e.scene.removeModel(e)}},s}(i));s._RF.pop()}}}));

System.register("chunks:///_virtual/grass-model-instancing.ts",["./rollupPluginModLoBabelHelpers.js","cc","./grass-model.ts"],(function(t){var e,i,r,s,a;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy,s=t.gfx},function(t){a=t.GrassModel}],execute:function(){r._RF.push({},"e9a25tiX+VJIIbYuH4g2E0y","grass-model-instancing",void 0);t("GrassModelInstancing",function(t){function r(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).VERTEX_ATTRS=[new s.Attribute(s.AttributeName.ATTR_POSITION,s.Format.RGB32F,!1,0,!0),new s.Attribute(s.AttributeName.ATTR_NORMAL,s.Format.RGB32F,!1,0,!0),new s.Attribute(s.AttributeName.ATTR_TEX_COORD,s.Format.RG32F,!1,1)],e._vertAttrSizeStatic=void 0,e._vertStaticAttrsFloatCount=void 0,e}e(r,t);var n=r.prototype;return n.init=function(t,e){this._vertCount=e.vertCount,this._indexCount=e.indexCount,this._indices=e.indice,this._uvs=e.uvs,this._grassCount=Math.max(this._capacity,a.INITIAL_CAPACITY),this._material=t,this._vertAttrSize=0,this._vertAttrSizeStatic=0;for(var r,n=i(this.VERTEX_ATTRS);!(r=n()).done;){var o=r.value;0===o.stream?(o.offset=this._vertAttrSize,this._vertAttrSize+=s.FormatInfos[o.format].size):1===o.stream&&(o.offset=this._vertAttrSizeStatic,this._vertAttrSizeStatic+=s.FormatInfos[o.format].size)}this._vertAttrsFloatCount=this._vertAttrSize/4,this._vertStaticAttrsFloatCount=this._vertAttrSizeStatic/4,this.buildMesh()},n.prepareSubMeshData=function(){this.prepareSubMeshDataDynamicVertex(),this.prepareSubMeshDataStaticVertex(),this.prepareSubMeshDataIndice(),this._vdataF32=new Float32Array(this._vBuffer),this._iaVertCount=this._vertCount,this._iaIndexCount=this._indexCount},n.prepareSubMeshDataDynamicVertex=function(){var t=this._device.createBuffer(new s.BufferInfo(s.BufferUsageBit.VERTEX|s.BufferUsageBit.TRANSFER_DST,s.MemoryUsageBit.HOST|s.MemoryUsageBit.DEVICE,this._vertAttrSize*this._grassCount,this._vertAttrSize));this._vBuffer=new ArrayBuffer(this._vertAttrSize*this._grassCount),t.update(this._vBuffer),this._vertexBuffers.push(t)},n.prepareSubMeshDataStaticVertex=function(){for(var t=this._device.createBuffer(new s.BufferInfo(s.BufferUsageBit.VERTEX|s.BufferUsageBit.TRANSFER_DST,s.MemoryUsageBit.HOST|s.MemoryUsageBit.DEVICE,this._vertAttrSizeStatic*this._vertCount,this._vertAttrSizeStatic)),e=new ArrayBuffer(this._vertAttrSizeStatic*this._vertCount),i=new Float32Array(e),r=0;r<this._uvs.length;++r)i[r]=this._uvs[r];t.update(e),this._vertexBuffers.push(t)},n.prepareSubMeshDataIndice=function(){for(var t=new Uint16Array(this._indexCount),e=0;e<this._indexCount;e++)t[e]=this._indices[e];var i=this._device.createBuffer(new s.BufferInfo(s.BufferUsageBit.INDEX|s.BufferUsageBit.TRANSFER_DST,s.MemoryUsageBit.DEVICE,this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));i.update(t),this._indexBuffer=i},n.updateVertex=function(t){for(var e=0;e<t.count;e++){var i=e*this._vertAttrsFloatCount;this._vdataF32[i++]=t.positions[3*e+0],this._vdataF32[i++]=t.positions[3*e+1],this._vdataF32[i++]=t.positions[3*e+2],this._vdataF32[i++]=t.normals[3*e+0],this._vdataF32[i++]=t.normals[3*e+1],this._vdataF32[i++]=t.normals[3*e+2]}},n.updateIA=function(t){var e=this._subModels[0].inputAssembler;e.vertexBuffers[0].update(this._vdataF32),e.firstIndex=0,e.indexCount=this._indexCount,e.instanceCount=t,e.vertexCount=this._iaVertCount},r}(a));r._RF.pop()}}}));

System.register("chunks:///_virtual/grass-model-normal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./grass-model.ts"],(function(t){var s,e,r,a;return{setters:[function(t){s=t.inheritsLoose},function(t){e=t.cclegacy,r=t.gfx},function(t){a=t.GrassModel}],execute:function(){e._RF.push({},"bdb37vZzMdNYbmkyAc99i7z","grass-model-normal",void 0);t("GrassModelNormal",function(t){function e(){for(var s,e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];return(s=t.call.apply(t,[this].concat(a))||this).VERTEX_ATTRS=[new r.Attribute(r.AttributeName.ATTR_POSITION,r.Format.RGB32F),new r.Attribute(r.AttributeName.ATTR_NORMAL,r.Format.RGB32F),new r.Attribute(r.AttributeName.ATTR_TEX_COORD,r.Format.RG32F)],s}s(e,t);var a=e.prototype;return a.updateVertex=function(t){for(var s=0;s<t.count;s++)for(var e=0;e<this._vertCount;e++){var r=(e+s*this._vertCount)*this._vertAttrsFloatCount;this._vdataF32[r++]=t.positions[3*s+0],this._vdataF32[r++]=t.positions[3*s+1],this._vdataF32[r++]=t.positions[3*s+2],this._vdataF32[r++]=t.normals[3*s+0],this._vdataF32[r++]=t.normals[3*s+1],this._vdataF32[r++]=t.normals[3*s+2],this._vdataF32[r++]=this._uvs[2*e+0],this._vdataF32[r++]=this._uvs[2*e+1]}},a.updateIA=function(t){var s=this._subModels[0].inputAssembler;s.vertexBuffers[0].update(this._vdataF32),s.firstIndex=0,s.indexCount=this._indexCount*t,s.vertexCount=this._iaVertCount},e}(a));e._RF.pop()}}}));

System.register("chunks:///_virtual/grass-model.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,r,a,n;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,r=t.gfx,a=t.RenderingSubMesh,n=t.renderer}],execute:function(){s._RF.push({},"32a78MPIQFMi6CIKb7IVu7i","grass-model",void 0);var u=t("GrassModel",function(t){function s(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this)._material=null,e._vertAttrSize=void 0,e._vertAttrsFloatCount=void 0,e._capacity=s.INITIAL_CAPACITY,e._grassCount=s.INITIAL_CAPACITY,e._vBuffer=null,e._vdataF32=null,e._vertCount=0,e._indexCount=0,e._indices=void 0,e._uvs=void 0,e._vertexBuffers=[],e._indexBuffer=void 0,e._subMeshData=null,e._iaVertCount=0,e._iaIndexCount=0,e}e(s,t);var n=s.prototype;return n.init=function(t,e){this._vertCount=e.vertCount,this._indexCount=e.indexCount,this._indices=e.indice,this._uvs=e.uvs,this._grassCount=Math.max(this._capacity,s.INITIAL_CAPACITY),this._material=t,this._vertAttrSize=0;for(var a,n=i(this.VERTEX_ATTRS);!(a=n()).done;){var u=a.value;u.offset=this._vertAttrSize,this._vertAttrSize+=r.FormatInfos[u.format].size}this._vertAttrsFloatCount=this._vertAttrSize/4,this.buildMesh()},n.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._grassCount=Math.max(this._capacity,s.INITIAL_CAPACITY),this._subMeshData&&e&&this.buildMesh()},n.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},n.updateGrass=function(t){t.count<=0||(t.count>this._grassCount&&this.setCapacity(t.count),this.updateVertex(t),this.updateIA(t.count))},n.buildMesh=function(){this.destroySubMeshData(),this.prepareSubMeshData(),this.createSubMeshData()},n.destroySubMeshData=function(){this._vertexBuffers.length=0,this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},n.prepareSubMeshData=function(){var t=this._device.createBuffer(new r.BufferInfo(r.BufferUsageBit.VERTEX|r.BufferUsageBit.TRANSFER_DST,r.MemoryUsageBit.HOST|r.MemoryUsageBit.DEVICE,this._vertAttrSize*this._grassCount*this._vertCount,this._vertAttrSize));this._vBuffer=new ArrayBuffer(this._vertAttrSize*this._grassCount*this._vertCount),t.update(this._vBuffer);for(var e=new Uint16Array(this._grassCount*this._indexCount),i=0;i<this._capacity;i++)for(var s=0;s<this._indexCount;s++)e[i*this._indexCount+s]=this._indices[s]+i*this._vertCount;var a=this._device.createBuffer(new r.BufferInfo(r.BufferUsageBit.INDEX|r.BufferUsageBit.TRANSFER_DST,r.MemoryUsageBit.DEVICE,this._grassCount*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));a.update(e),this._vdataF32=new Float32Array(this._vBuffer),this._vertexBuffers.push(t),this._indexBuffer=a,this._iaVertCount=this._capacity*this._vertCount,this._iaIndexCount=this._capacity*this._indexCount},n.createSubMeshData=function(){this._subMeshData=new a(this._vertexBuffers,this.VERTEX_ATTRS,r.PrimitiveMode.TRIANGLE_LIST,this._indexBuffer),this.initSubModel(0,this._subMeshData,this._material)},s}(n.scene.Model));u.INITIAL_CAPACITY=16,u.MAX_CAPACITY=1024,s._RF.pop()}}}));

System.register("chunks:///_virtual/grass-sampler-module.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,i,n,a,s,o,l,h,u,d,_,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.initializerDefineProperty},function(t){i=t.cclegacy,n=t._decorator,a=t.gfx,s=t.v3,o=t.Node,l=t.CCFloat,h=t.CCBoolean,u=t.MeshRenderer,d=t.utils,_=t.director,c=t.size}],execute:function(){var T,g,p,x,y,f,m,b,I;i._RF.push({},"3c37eazXntHUK9PKonuIqPs","grass-sampler-module",void 0);var P=n.ccclass,v=n.property,A=a.AttributeName,z=A.ATTR_POSITION,M=A.ATTR_NORMAL,w=A.ATTR_TEX_COORD,R=a.PrimitiveMode.TRIANGLE_LIST,S=s(),C=s(),L=s(),B=s(),N=s(),F=0,G=0,O=0,E=s(),D=s(),X=s(),q=0,H=0;t("GrassSamplerModule",(T=P("GrassSamplerModule"),g=v(o),p=v({type:l,min:0}),x=v(h),T((m=e((f=function(){function t(){r(this,"ground",m,this),r(this,"density",b,this),r(this,"useProbabilityTexture",I,this),this._terrainPosition=void 0,this._terrainNormal=void 0,this._terrainIndices=void 0,this._terrainTexCoord=void 0,this._terrainTexture=void 0,this._terrainTextureSize=void 0,this._probList=void 0,this._totalArea=0}var e=t.prototype;return e.sample=function(){return this._readTerrain(this.ground.getComponent(u)),this._calcTriangleArea(),this._generateGrass()},e._readTerrain=function(t){var e,r=t.mesh,i=t.material;if((null!=(e=d.readMesh(r).primitiveMode)?e:R)!==R)throw new Error("PrimitiveMode of Terrain Mesh should be TRIANGLE_LIST");if(this._terrainPosition=r.readAttribute(0,z),this._terrainNormal=r.readAttribute(0,M),this._terrainIndices=r.readIndices(0),this.useProbabilityTexture){this._terrainTexCoord=r.readAttribute(0,w);var n=i.getProperty("mainTexture").getGFXTexture(),s=n.width,o=n.height,l=new a.BufferTextureCopy;l.texOffset.x=0,l.texOffset.y=0,l.texExtent.width=s,l.texExtent.height=o,this._terrainTexture=new Uint8Array(s*o*4),_.root.device.copyTextureToBuffers(n,[this._terrainTexture],[l]),this._terrainTextureSize=c(s,o)}},e._calcTriangleArea=function(){this._totalArea=0,this._probList=new Float32Array(this._terrainIndices.length/3);for(var t=0,e=0;e<this._terrainIndices.length;e+=3)this._readPointByTriangleIndex(e,this._terrainPosition,S,C,L,3),B.set(C).subtract(S),N.set(L).subtract(S),t=.5*B.cross(N).length(),this._totalArea+=t,this._probList[e/3]=this._totalArea},e._readPointByTriangleIndex=function(t,e,r,i,n,a){F=this._terrainIndices[t],G=this._terrainIndices[t+1],O=this._terrainIndices[t+2],r.set(e[F*a+0],e[F*a+1],e[F*a+2]),i.set(e[G*a+0],e[G*a+1],e[G*a+2]),n.set(e[O*a+0],e[O*a+1],e[O*a+2]),3===a&&(r.z=e[F*a+2],i.z=e[G*a+2],n.z=e[O*a+2])},e._generateGrass=function(){for(var t=~~(this._totalArea*this.density),e=new Float32Array(3*t),r=new Float32Array(3*t),i=0,n=0,a=0,s=0;s<t;s++){if(n=this._totalArea*Math.random(),a=this._probList.findIndex((function(t){return t>=n})),q=Math.sqrt(Math.random()),H=Math.random(),this._readPointByTriangleIndex(3*a,this._terrainPosition,S,C,L,3),this._getRandomPointInTriangle(q,H,S,C,L,E),this._readPointByTriangleIndex(3*a,this._terrainNormal,S,C,L,3),this._getRandomPointInTriangle(q,H,S,C,L,D),D.normalize(),this.useProbabilityTexture){this._readPointByTriangleIndex(3*a,this._terrainTexCoord,S,C,L,2),this._getRandomPointInTriangle(q,H,S,C,L,X);var o=~~(this._terrainTextureSize.width*X.x),l=~~(this._terrainTextureSize.height*X.y);if(this._terrainTexture[4*(o+l*this._terrainTextureSize.width)+3]/255<Math.random())continue}e[3*i+0]=E.x,e[3*i+1]=E.y,e[3*i+2]=E.z,r[3*i+0]=D.x,r[3*i+1]=D.y,r[3*i+2]=D.z,i++}return{positions:e=e.subarray(0,3*i),normals:r=r.subarray(0,3*i),count:i}},e._getRandomPointInTriangle=function(t,e,r,i,n,a){a.set(r.multiplyScalar(1-t)).add(i.multiplyScalar(t*(1-e))).add(n.multiplyScalar(t*e))},t}()).prototype,"ground",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=e(f.prototype,"density",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),I=e(f.prototype,"useProbabilityTexture",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),y=f))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/grass-sampler.ts",["cc"],(function(){var s;return{setters:[function(e){s=e.cclegacy}],execute:function(){s._RF.push({},"2342eT4JBZJS5swByQQNcO+","grass-sampler",void 0),s._RF.pop()}}}));

System.register("chunks:///_virtual/grass-spawner-module.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n,r,u,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.createClass,s=t.initializerDefineProperty},function(t){n=t.cclegacy,r=t._decorator,u=t.Enum,h=t.CCInteger}],execute:function(){var o,c,a,g,v,l,_;n._RF.push({},"00354qUDAxJqqAKm8ILkPm9","grass-spawner-module",void 0);var p=r.ccclass,f=r.property,d=t("GrassShape",function(t){return t[t.QUAD=0]="QUAD",t[t.SHARP=1]="SHARP",t}({}));u(d);t("GrassSpawnerModule",(o=p("GrassSpawnerModule"),c=f({type:d}),a=f({type:h,min:1,max:4}),o((l=e((v=function(){function t(){s(this,"shape",l,this),s(this,"segment",_,this),this._indice=[0,1,2,1,3,2],this._uvs=[0,1,1,1,0,0,1,0]}return t.prototype.spawn=function(){this._indice.length=this.indexCount,this._uvs.length=this.uvsCount;for(var t=0;t<this.segment;t++)this._indice[6*t+0]=2*t+0,this._indice[6*t+1]=2*t+1,this._indice[6*t+2]=2*t+2,this._indice[6*t+3]=2*t+1,this._indice[6*t+4]=2*t+3,this._indice[6*t+5]=2*t+2;if(this.shape===d.QUAD)for(var e=0;e<=this.segment;e++)this._uvs[4*e+0]=0,this._uvs[4*e+1]=1-e/this.segment,this._uvs[4*e+2]=1,this._uvs[4*e+3]=1-e/this.segment;else if(this.shape===d.SHARP){this._uvs[0]=.5,this._uvs[1]=1,this._uvs[this._uvs.length-2]=.5,this._uvs[this._uvs.length-1]=0;for(var i=0;i<this.segment;i++)this._uvs[4*i+2+0]=1,this._uvs[4*i+2+1]=1-(i+1)/(this.segment+1),this._uvs[4*i+2+2]=0,this._uvs[4*i+2+3]=1-(i+1)/(this.segment+1)}return this},i(t,[{key:"triangleCount",get:function(){return 2*this.segment}},{key:"vertCount",get:function(){return 2+2*this.segment}},{key:"uvsCount",get:function(){return 2*this.vertCount}},{key:"coordCount",get:function(){return 3*this.vertCount}},{key:"indexCount",get:function(){return 3*this.triangleCount}},{key:"indice",get:function(){return this._indice}},{key:"uvs",get:function(){return this._uvs}}]),t}()).prototype,"shape",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d.SHARP}}),_=e(v.prototype,"segment",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),g=v))||g));n._RF.pop()}}}));

System.register("chunks:///_virtual/grass-spawner.ts",["cc"],(function(){var s;return{setters:[function(e){s=e.cclegacy}],execute:function(){s._RF.push({},"44767vUTIZC7Ydhwg55Q6wu","grass-spawner",void 0),s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./grass-base.ts","./grass-model-instancing.ts","./grass-model-normal.ts","./grass-model.ts","./grass-animation-module.ts","./grass-sampler-module.ts","./grass-spawner-module.ts","./grass-animation.ts","./grass-sampler.ts","./grass-spawner.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});